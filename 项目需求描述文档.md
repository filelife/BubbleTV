# 项目需求描述文档

## 1. 项目概述

### 1.1 项目名称
泡泡看视频 - 自动视频下载应用

### 1.2 项目背景
随着视频内容的爆炸式增长，用户对视频下载和管理的需求日益增长。当前市场上的下载工具存在操作复杂、功能单一、稳定性差等问题，用户需要一个简单易用、功能强大的自动视频下载解决方案。

### 1.3 项目目标
开发一款能够自动识别、下载和管理网络视频的应用，专门支持抖音、今日头条、Bilibili三个站点的视频下载，提供智能化的下载管理功能和目录分类管理，提升用户体验。

### 1.4 项目范围
- 支持抖音、今日头条、Bilibili三个主流视频平台的视频下载
- 提供自动识别和批量下载功能
- 实现视频管理和分类功能，区分短视频和影视剧类型
- 支持指定目录存放和目录命名规则
- 提供反爬技术方案，包括下载任务间隔设置
- 采用Webview开发，部署为内网服务
- 支持家庭网络下通过同一IP地址访问
- **任务日志系统**：提供完整的任务执行日志记录和查看功能

## 2. 核心功能

### 2.1 用户功能

#### 2.1.1 账户管理
- 用户注册和登录
- 个人信息管理
- 账户安全设置
- 支持在网页上登录B站、抖音、头条
- Cookie存储和管理
- Cookie有效期监控和自动更新
- 支持多平台账号同时登录

#### 2.1.2 视频下载
- 单视频下载
- 批量视频下载
- 自动识别视频链接
- 自动识别视频平台：根据URL自动识别抖音、今日头条、Bilibili
- 自动识别视频类型：根据页面信息自动判断是短视频还是影视剧
- 支持多种视频格式选择
- 下载速度控制和限速功能
- 指定目录存放功能
- 目录命名规则：与视频在各个网页上的标题名称一致
- 支持抖音、今日头条、Bilibili三个站点的视频解析
- 下载链接自检测功能：检测URL的合法性
- 下载进度条：实时显示下载进度
- 下载速度显示：实时显示下载速度（B/s、KB/s、MB/s、GB/s）
- 错误提示机制：链接出现问题时提供相关提示
- **任务日志查看**：点击"日志"按钮查看完整的任务执行日志
- **转码进度显示**：转码过程中实时显示进度条和百分比
- **任务取消功能**：支持取消下载中和转码中的任务

**支持的视频链接格式示例**：
- Bilibili：`https://b23.tv/LjR909D` 或 `https://www.bilibili.com/video/BV1234567890`
- 抖音：`https://v.douyin.com/IBBnrqQWO10/` 或 `https://www.douyin.com/video/1234567890`
- 今日头条：`https://m.toutiao.com/is/V1HENyz7IqU/` 或 `https://www.toutiao.com/video/1234567890`

#### 2.1.3 视频管理
- 视频分类和标签管理
- 视频预览和播放
- 视频转码和格式转换
- 视频分享功能
- 视频类型自动分类：区分短视频和影视剧类型
- 目录管理方案：根据视频类型创建不同的上一级目录
- 目录结构：[视频类型]/[视频标题]/
- 自动转码为MOV格式：下载完成后自动转换为MOV格式
- FFmpeg集成：需要本地安装FFmpeg进行视频转码
- **转码进度监控**：使用实际视频时长计算进度，避免进度卡住
- **转码超时保护**：30分钟超时自动终止转码进程

#### 2.1.5 存储目录管理
- 首次下载时支持选择存储目录
- 存储目录地址本地持久化存储
- 页面启动时自动读取存储目录配置
- 首次使用时提示选择下载目录
- 支持更换存储目录功能
- 更换目录时提供迁移选项：
  - 选项一：将已下载资源全部迁移至新目录
  - 选项二：仅更新新的存储地址
- 文件迁移时提供进度提示
- 迁移过程中提示不要关闭终端
- 中断迁移恢复机制：
  - 下次启动时检查两个目录文件
  - 确认是否都完成了迁移
  - 未完成的迁移提示用户是否继续完成传输
- 迁移状态持久化存储
- 调起访达进行地址选择：
  - 支持调用访达（Finder）进行地址选择
  - 选择到文件夹维度，确保选择的是目录而非文件
  - 跨平台支持（macOS和Windows）
  - 选择结果自动填充到存储目录配置中

#### 2.1.6 任务管理
- 下载任务队列管理
- 任务暂停、恢复和取消
- 任务优先级设置
- 下载历史记录
- 任务列表浏览功能：查看过去的下载任务
- 任务状态检查：文件存在性验证，不存在则任务置为灰色
- 任务操作功能：
  - 打开：打开任务所在目录
  - 删除：删除任务下的已下载文件
  - 重试：重试失败的任务
  - 查看日志：查看任务执行日志
- 任务列表样式：
  ```
  ---------------------------------------------
  |    xxxxx视频名称                       打开      删除   |
  ---------------------------------------------
  ```
- **任务状态**：
  - pending：等待中
  - downloading：下载中
  - transcoding：转码中
  - completed：已完成
  - failed：下载失败
  - cancelled：已取消

### 2.2 系统功能

#### 2.2.1 视频源管理
- 支持主流视频平台接入
- 视频源更新和维护
- 视频源API对接

#### 2.2.2 智能识别
- 视频链接自动识别
- 视频信息提取和解析
- 视频质量和格式检测

#### 2.2.3 下载引擎
- 多线程下载
- 断点续传
- 网络自适应
- 下载失败重试机制
- 反爬技术方案：
  - 下载任务间隔设置
  - 合集类型页面的特殊处理
  - 请求头随机化
  - IP轮换机制（可选）
- **下载超时优化**：大视频下载超时从30秒延长到600秒（10分钟）

#### 2.2.4 存储管理
- 本地存储管理
- 云端存储集成
- 存储空间监控和清理
- **任务日志存储**：使用Redis存储任务执行日志，最多保留100条
- **日志查询API**：提供RESTful API查询任务日志

## 3. 技术要求

### 3.1 技术栈

#### 3.1.1 前端技术
- 框架：Webview
- 语言：HTML5 + CSS3 + JavaScript
- 状态管理：LocalStorage / SessionStorage
- UI组件库：自定义组件 + 第三方库

#### 3.1.2 后端技术
- 语言：Python / Node.js
- 框架：FastAPI / Express
- 数据库：MongoDB / PostgreSQL
- 缓存：Redis

#### 3.1.3 基础设施
- 内网服务部署：本地服务器或NAS设备
- 网络配置：家庭网络下固定IP地址
- 容器化：Docker（可选）
- 服务管理：系统服务或容器管理
- 访问控制：家庭网络内访问权限设置

### 3.2 性能要求
- 单视频下载速度：至少达到网络带宽的80%
- 批量下载支持：同时支持至少10个任务并行
- 应用响应时间：界面操作响应时间不超过200ms
- 系统稳定性：7*24小时稳定运行
- **转码性能**：使用实际视频时长计算进度，避免进度不准确
- **下载超时**：大视频下载支持10分钟超时

### 3.3 安全要求
- 数据加密：用户数据和下载内容加密存储
- 网络安全：HTTPS传输，防止中间人攻击
- 权限控制：严格的用户权限管理
- 防爬虫：合理的请求频率限制

## 4. 用户界面设计

### 4.1 设计风格
- 现代简约风格
- 深色/浅色模式支持
- 响应式设计，适配不同设备

### 4.2 主要页面

#### 4.2.1 首页
- 页面分为两个tab：
  - **Tab1**：连接复制+下载任务
    - 视频链接输入
    - 平台选择
    - 视频类型选择
    - 下载按钮
    - 下载任务列表
    - 任务状态实时更新
    - 任务操作控制
    - **任务日志查看**：每个任务都有"日志"按钮
    - **转码进度显示**：转码中任务显示黄色进度条
    - **任务取消功能**：下载中和转码中任务支持取消
  - **Tab2**：已下载任务管理
    - 树状结构目录展示已下载资源
    - 根据保存文件目录结构自动生成
    - 右上角搜索入口
    - 实时搜索功能：每输入一个字进行全局匹配
    - 支持文件夹和文件检索
    - 点击搜索结果后树状结构展开到对应内容
    - 手动拖拽功能：支持将视频文件和文件夹拖动到其他目录下
    - 拖拽操作提示：拖拽时显示目标目录的高亮效果

#### 4.2.2 个人中心
- 用户信息展示
- 应用设置
- 帮助和反馈

### 4.3 交互设计
- 拖拽操作支持
- 手势控制优化
- 动画效果流畅
- 操作反馈及时
- **任务状态反馈**：每个状态变化都有明确的视觉反馈
- **日志查看体验**：点击日志按钮弹出模态框显示完整日志

## 5. 开发时间线

### 5.1 项目阶段

| 阶段 | 时间 | 主要任务 |
|------|------|----------|
| 需求分析 | 1周 | 详细需求调研和分析 |
| 技术架构设计 | 1周 | 系统架构和技术选型（Webview + 后端服务） |
| 前端开发 | 2周 | Webview界面和交互实现 |
| 后端开发 | 3周 | 服务端API、视频解析和下载核心功能实现 |
| 反爬策略开发 | 1周 | 反爬技术方案实现（任务间隔、请求头随机化等） |
| 部署配置 | 1周 | 内网服务部署和网络配置 |
| 测试阶段 | 2周 | 功能测试和性能优化 |
| **日志系统开发** | 0.5周 | 任务日志系统实现 |
| **UI优化** | 0.5周 | 转码进度显示和任务取消功能 |
| 总计 | 11.5周 | - |

### 5.2 里程碑
- M1: 需求分析完成，技术架构确定
- M2: 核心功能开发完成，内部测试版本
- M3: 功能测试和优化完成，发布候选版本
- M4: 应用正式发布，用户反馈收集
- **M5**: 日志系统上线，支持任务执行日志查看
- **M6**: UI优化完成，转码进度准确显示

## 6. 风险评估

### 6.1 技术风险
- 抖音、今日头条、Bilibili平台API变化导致下载功能失效
- Webview兼容性问题
- 内网网络环境不稳定影响访问体验
- 大文件下载对系统资源的占用
- 反爬策略的有效性和稳定性
- **转码进度不准确**：使用固定时长导致进度显示错误
- **下载超时**：大视频下载超时设置过短

### 6.2 法律风险
- 视频版权问题
- 数据隐私合规
- 地区性法律法规差异

### 6.3 部署风险
- 内网服务稳定性
- 家庭网络安全
- IP地址冲突或变更

### 6.4 应对策略
- 建立视频平台API监控机制，及时适配变化
- 优化网络处理逻辑，提高系统稳定性
- 严格遵守版权法规，明确用户使用条款
- 定期更新反爬策略，应对平台反爬机制
- 加强内网安全配置，设置合理的访问权限
- 配置静态IP地址，确保服务稳定访问
- 提供详细的部署文档和故障排查指南
- **使用实际视频时长计算转码进度**：避免进度不准确
- **延长下载超时时间**：大视频下载支持10分钟超时

## 7. 验收标准

### 7.1 功能验收
- 所有核心功能正常运行
- 支持至少5个主流视频平台
- 批量下载任务成功率≥95%
- 视频下载速度达到预期要求
- **任务日志功能正常**：能够查看完整的任务执行日志
- **转码进度准确**：使用实际视频时长计算进度
- **任务取消功能正常**：能够取消下载中和转码中的任务

### 7.2 性能验收
- 应用启动时间≤3秒
- 界面操作响应时间≤200ms
- 同时支持10个并行下载任务
- 7*24小时稳定运行无崩溃
- **转码进度更新及时**：进度更新间隔不超过1秒

### 7.3 用户体验验收
- 用户满意度评分≥4.5（满分5分）
- 操作流程简单直观
- 界面设计美观流畅
- 错误提示清晰友好
- **日志查看体验良好**：日志显示清晰，易于理解
- **任务状态反馈及时**：状态变化立即反映在界面上

## 8. 附录

### 8.1 术语定义
- 视频源：提供视频内容的平台或网站
- 下载引擎：负责视频数据下载的核心模块
- 批量下载：同时处理多个视频下载任务
- 断点续传：网络中断后恢复下载的功能
- 视频转码：将视频转换为不同格式的过程
- **任务日志**：记录任务执行过程中的关键信息
- **转码进度**：视频转码过程中的完成百分比

### 8.2 参考资料
- 主流视频平台API文档
- 视频下载技术白皮书
- 用户体验设计指南
- 相关法律法规文件

### 8.3 联系方式
- 项目负责人：[姓名]
- 联系电话：[电话]
- 电子邮箱：[邮箱]
- 项目地址：[地址]

---

*文档版本：V1.1*
*创建日期：2026-02-07*
*最后更新：2026-02-08*
*更新内容*：
  - 添加任务日志系统需求
  - 添加转码进度准确显示需求
  - 添加任务取消功能需求
  - 优化下载超时设置
